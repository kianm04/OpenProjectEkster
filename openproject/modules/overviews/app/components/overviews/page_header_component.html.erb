<%=
  render(Primer::OpenProject::PageHeader.new) do |header|
    header.with_title(variant: :medium) { page_title }
    header.with_breadcrumbs(nil)

    header.with_action_icon_button(
      icon: favorited? ? "star-fill" : "star",
      mobile_icon: favorited? ? "star-fill" : "star",
      size: :medium,
      tag: :a,
      href: helpers.build_favorite_path(project, format: :html),
      data: { turbo_method: favorited? ? :delete : :post },
      classes: favorited? ? "op-primer--star-icon" : "",
      label: favorited? ? I18n.t(:button_unfavorite) : I18n.t(:button_favorite),
      aria: { label: favorited? ? I18n.t(:button_unfavorite) : I18n.t(:button_favorite) },
      test_selector: "project-favorite-button"
    )

    header.with_action_menu(
      menu_arguments: { anchor_align: :end },
      button_arguments: { icon: "kebab-horizontal", "aria-label": t(:label_menu) }
    ) do |menu|
      if allowed_to_select_project_custom_fields?
        menu.with_item(
          label: t(:label_project_attribute_manage_link),
          href: helpers.project_settings_project_custom_fields_path(project),
          data: { turbo: false }
        ) do |item|
          item.with_leading_visual_icon(icon: :pencil)
        end
      end

      if allowed_to_export_project_initiation_pdf?
        menu.with_item(
          label: t(:label_project_initiation_export_pdf, project_creation_name: project_creation_wizard_name(project)),
          href: helpers.export_project_initiation_project_path(project, format: :pdf),
          data: { turbo: false }
        ) do |item|
          item.with_leading_visual_icon(icon: :download)
        end
      end

      if allowed_to_archive?
        menu.with_item(
          label: t(:label_archive_project),
          href: helpers.dialog_project_archive_path(project),
          content_arguments: { data: { turbo_stream: true } }
        ) do |item|
          item.with_leading_visual_icon(icon: :lock)
        end
      end
    end

    if OpenProject::FeatureDecisions.new_project_overview_active?
      header.with_tab_nav(label: nil, test_selector: "overview-tabs") do |tab_nav|
        tab_nav.with_tab(
          test_selector: "project-overview-tab",
          selected: current_page?(project_overview_path),
          href: helpers.project_overview_path
        ) do |t|
          t.with_icon(icon: :"op-view-split")
          t.with_text { I18n.t("overviews.label_overview") }
        end

        if current_user.allowed_in_project?(:view_project, project)
          tab_nav.with_tab(
            test_selector: "project-dashboard-tab",
            selected: current_page?(dashboard_project_overview_path),
            href: helpers.dashboard_project_overview_path
          ) do |t|
            t.with_icon(icon: :"op-view-list")
            t.with_text { I18n.t("overviews.label_dashboard") }
          end
        end
      end
    end
  end
%>
